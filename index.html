<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>One Thing</title>
<style>
  :root{
    --bg:#f5f6f8;
    --panel:#ffffff;
    --ink:#131313;
    --muted:#6b7280;
    --line:#e7e7ea;
    --blue:#0b57d0;
    --green:#17a34a;
    --shadow:0 8px 28px rgba(0,0,0,.06), 0 2px 6px rgba(0,0,0,.05);
    --radius:18px;
  }

  /* Type: serif for headings (assistant-manual vibe), clean sans for body */
  html,body{margin:0;background:var(--bg);color:var(--ink)}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
  h1,h2,th{font-family:Georgia,"Times New Roman",Times,serif;letter-spacing:.2px}

  /* Hero */
  .hero{
    background:linear-gradient(180deg, rgba(11,87,208,.96) 0%, rgba(11,87,208,.88) 100%);
    color:#fff; text-align:center; padding:54px 18px 42px;
  }
  .hero h1{margin:0 0 10px;font-size:42px;line-height:1.12}
  .hero p{margin:0 auto;max-width:680px;opacity:.95;font-size:18px}

  /* Layout */
  .wrap{max-width:860px;margin:-34px auto 64px;padding:0 18px}
  .card{
    background:var(--panel); border:1px solid var(--line); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:22px 22px; margin:18px 0;
  }

  /* Goal / daily input */
  .label{color:var(--muted); font-weight:600; margin-bottom:8px}
  .goal-title{font-family:Georgia,"Times New Roman",Times,serif;font-weight:700;font-size:26px;margin:0 0 10px}
  .stack{display:flex; flex-direction:column; gap:12px; align-items:stretch}
  .field{
    width:100%; border:1px solid var(--line); border-radius:14px; padding:16px 18px;
    font:inherit; font-size:18px; background:#fff; color:var(--ink); box-sizing:border-box;
  }
  .field::placeholder{color:#9aa0a6;opacity:1}
  .btn{
    width:100%; border:0; border-radius:14px; padding:16px 18px; font:inherit; font-weight:600;
    background:var(--green); color:#fff; cursor:pointer; transition:filter .15s ease, transform .02s ease;
  }
  .btn:active{transform:translateY(1px)}
  .hint{color:var(--muted); font-size:14px; margin-top:4px}

  /* Status pill */
  .status{
    display:flex; flex-direction:column; gap:6px; font-size:18px;
  }
  .tick{display:inline-block;transform:translateZ(0);transition:transform .18s ease}
  .tick.pop{transform:scale(1.2)}

  /* Table */
  .table-card{padding:0}
  .table-wrap{padding:10px 14px 14px}
  table{width:100%; border-collapse:separate; border-spacing:0}
  thead th{
    text-align:left; color:#3b3b3b; font-weight:700; font-size:16px; padding:12px 10px 10px;
    border-bottom:1px solid var(--line);
  }
  tbody td{padding:14px 10px; border-bottom:1px solid var(--line); vertical-align:top}
  .col-date{width:38%; max-width:340px; color:#374151; font-family:Georgia,"Times New Roman",Times,serif}
  .col-line{width:62%; font-size:18px}
  @media (min-width:540px){ .col-date{width:34%} .col-line{width:66%} }
  @media (min-width:820px){ .col-date{width:32%} .col-line{width:68%} }

  /* Complete */
  .complete {
    background:var(--panel); border:1px solid var(--line); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:18px; text-align:center;
  }

  /* Accessibility focus */
  .field:focus, .btn:focus{outline:3px solid rgba(11,87,208,.25); outline-offset:2px}
</style>
</head>
<body>
  <header class="hero">
    <h1>One Thing</h1>
    <p>It doesnâ€™t tell you what to do â€” it asks what youâ€™ve done. ðŸ’™</p>
  </header>

  <main class="wrap">
    <!-- First visit -->
    <section id="goalCard" class="card" style="display:none">
      <div class="stack">
        <label for="goalInput" class="label">Whatâ€™s your one goal?</label>
        <input id="goalInput" class="field" maxlength="80" placeholder="One line (e.g., Close one Â£20k sale)" />
        <button id="saveGoal" class="btn">Save</button>
      </div>
    </section>

    <!-- Daily -->
    <section id="dailyCard" class="card" style="display:none">
      <div class="label">Goal</div>
      <h2 id="goalLabel" class="goal-title"></h2>
      <div class="stack">
        <input id="lineInput" class="field" maxlength="120"
               placeholder="How did you move toward your goal today?"
               aria-label="How did you move toward your goal today?"/>
        <button id="logBtn" class="btn">Log today âœ…</button>
      </div>
      <div class="hint">One line per day. No edits later.</div>
    </section>

    <!-- After logging -->
    <section id="statusCard" class="card" style="display:none">
      <div class="status">
        <div id="statusText">Logged for today <span class="tick">âœ…</span></div>
        <div class="hint" id="streakLine"></div>
      </div>
    </section>

    <!-- History table -->
    <section id="historyCard" class="card table-card" style="display:none">
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th class="col-date">Date</th><th class="col-line">One line</th></tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Goal complete -->
    <section id="completeWrap" style="display:none">
      <div class="complete">
        <button id="completeBtn" class="btn">Goal complete âœ…</button>
      </div>
    </section>
  </main>

<script>
/* -------- storage helpers -------- */
const LS = {
  get:(k,f=null)=>{try{return JSON.parse(localStorage.getItem(k))??f}catch{return f}},
  set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),
  del:k=>localStorage.removeItem(k)
};

/* -------- virtual day per refresh (for testing) -------- */
const iso = d=>d.toISOString().slice(0,10);
const addDays=(s,n)=>{const d=new Date(s);d.setDate(d.getDate()+n);return iso(d)};
let vToday = LS.get('one_vToday');
if(!vToday){ vToday = iso(new Date()); } else { vToday = addDays(vToday,1); }
LS.set('one_vToday', vToday);

/* -------- pretty date: Thursday 25th September 2025 -------- */
const ord = n => {const s=["th","st","nd","rd"], v=n%100; return s[(v-20)%10]||s[v]||s[0];};
function pretty(isoStr){
  const d=new Date(isoStr);
  const weekday=d.toLocaleString('en-GB',{weekday:'long'});
  const day=d.getDate();
  const month=d.toLocaleString('en-GB',{month:'long'});
  const year=d.getFullYear();
  return `${weekday} ${day}${ord(day)} ${month} ${year}`;
}

/* -------- state -------- */
let goal    = LS.get('one_goal','');
let entries = LS.get('one_entries',[]); // [{date,line}]
const hasEntry = s => entries.some(e=>e.date===s);

/* -------- els -------- */
const goalCard   = document.getElementById('goalCard');
const goalInput  = document.getElementById('goalInput');
const saveGoal   = document.getElementById('saveGoal');

const dailyCard  = document.getElementById('dailyCard');
const goalLabel  = document.getElementById('goalLabel');
const lineInput  = document.getElementById('lineInput');
const logBtn     = document.getElementById('logBtn');

const statusCard = document.getElementById('statusCard');
const statusText = document.getElementById('statusText');
const streakLine = document.getElementById('streakLine');

const historyCard= document.getElementById('historyCard');
const historyBody= document.getElementById('historyBody');

const completeWrap=document.getElementById('completeWrap');
const completeBtn = document.getElementById('completeBtn');

/* -------- render helpers -------- */
function streak(){
  let s=0, d=vToday;
  while(hasEntry(d)){ s++; d=addDays(d,-1); }
  return s;
}

function renderHistory(){
  historyBody.innerHTML='';
  if(entries.length===0) return;
  const first = entries.map(e=>e.date).sort()[0];
  let cur=vToday;
  while(cur>=first){
    const found = entries.find(e=>e.date===cur);
    const line = found ? found.line : '';
    const tr=document.createElement('tr');
    tr.innerHTML = `<td class="col-date">${pretty(cur)}</td><td class="col-line">${line}</td>`;
    historyBody.appendChild(tr);
    cur=addDays(cur,-1);
  }
}

function showState(){
  if(!goal){
    goalCard.style.display='block';
    dailyCard.style.display='none';
    statusCard.style.display='none';
    historyCard.style.display='none';
    completeWrap.style.display='none';
    return;
  }
  goalCard.style.display='none';
  goalLabel.textContent=goal;

  if(!hasEntry(vToday)){
    dailyCard.style.display='block';
    statusCard.style.display='none';
    historyCard.style.display='none';
    completeWrap.style.display='none';
  }else{
    dailyCard.style.display='none';
    statusCard.style.display='block';
    const s=streak();
    statusText.innerHTML=`Logged for today <span class="tick">âœ…</span>`;
    streakLine.textContent=`Streak: ${s} day${s===1?'':'s'} âœ…`;
    document.querySelector('.tick').classList.add('pop');
    setTimeout(()=>document.querySelector('.tick').classList.remove('pop'),180);

    renderHistory();
    historyCard.style.display='block';
    completeWrap.style.display='block';
  }
}

/* -------- actions -------- */
saveGoal.onclick=()=>{
  const t=(goalInput.value||'').trim();
  if(!t){goalInput.focus();return;}
  goal=t; LS.set('one_goal',goal);
  showState();
};

logBtn.onclick=()=>{
  const line=(lineInput.value||'').trim();
  if(!line){lineInput.focus();return;}
  if(hasEntry(vToday)) return;
  entries.push({date:vToday,line});
  LS.set('one_entries',entries);
  lineInput.value='';
  showState();
  // scroll to status/table
  setTimeout(()=>document.getElementById('statusCard').scrollIntoView({behavior:'smooth',block:'start'}),50);
};

completeBtn.onclick=()=>{
  if(!confirm('Mark goal complete and reset?')) return;
  LS.del('one_goal'); LS.del('one_entries');
  goal=''; entries=[];
  showState();
};

/* -------- boot -------- */
showState();
</script>
</body>
</html>
