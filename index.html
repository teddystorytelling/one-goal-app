<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>One Thing</title>
<style>
  :root{
    --bg:#0b0c0f; --panel:#0f1116; --card:#111318; --border:#1c1f27;
    --text:#e8ebf0; --muted:#a7b0bf; --accent:#2ad66c;
    --glass:rgba(255,255,255,0.06); --glass-border:rgba(255,255,255,0.12);
    --shadow:0 12px 30px rgba(0,0,0,0.45);
    --radius:14px; --radius-sm:10px; --radius-xs:8px;
    --transition: 300ms cubic-bezier(.2,.8,.2,1);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 20% -10%, #19202e 0%, rgba(25,32,46,0) 60%),
      radial-gradient(1000px 500px at 120% 10%, #142033 0%, rgba(20,32,51,0) 60%),
      var(--bg);
    color:var(--text);
    font:16px/1.45 -apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:820px;margin:48px auto 96px;padding:0 20px}

  /* Header */
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:22px}
  .dot{
    width:12px;height:12px;border-radius:50%;
    background:linear-gradient(180deg,#9ef2c2 0%, #2ad66c 100%);
    box-shadow:0 0 0 6px rgba(42,214,108,.12),0 4px 16px rgba(42,214,108,.3);
  }
  h1{margin:0;font-size:clamp(22px,4vw,28px);font-weight:700;letter-spacing:-.01em}
  .subtitle{margin:2px 0 24px;color:var(--muted);font-size:14px}

  /* Nav */
  .nav{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap}
  .nav a{
    padding:8px 12px;border:1px solid var(--glass-border);
    border-radius:10px;background:var(--glass);font-size:13px
  }

  /* Cards */
  .card{
    background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)) , var(--card);
    border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:clip;
  }
  .stack{padding:18px;display:grid;gap:12px}
  .row{display:grid;grid-template-columns:1fr auto;gap:12px}
  @media (max-width:560px){.row{grid-template-columns:1fr}}

  /* Inputs / Buttons */
  .onething{
    width:100%;padding:16px;background:#0d0f13;border:1px solid var(--border);
    border-radius:var(--radius-sm);color:var(--text);font-size:16px;outline:none;
    transition:border-color .2s, box-shadow .2s;
  }
  .onething:focus{border-color:#2ad66c80;box-shadow:0 0 0 6px rgba(42,214,108,.08)}
  .btn{
    padding:14px 18px;background:linear-gradient(180deg,#34e07a,var(--accent));
    border:1px solid #2bd673;color:#05120b;font-weight:700;border-radius:var(--radius-sm);
    cursor:pointer;box-shadow:0 6px 18px rgba(42,214,108,.35);transition:transform .05s,filter .2s;
  }
  .btn:active{transform:translateY(1px);filter:brightness(.95)}
  .btn[disabled]{opacity:.55;cursor:default;transform:none;filter:none}

  /* Mini today capsule */
  .today{
    margin: -6px 18px 10px;
    padding:10px 12px;border:1px solid var(--glass-border);border-radius:12px;background:var(--glass);
    display:none;gap:8px;align-items:center;color:var(--muted);font-size:13px
  }
  .today strong{color:var(--text);font-weight:600}

  /* Footer (hidden until first log) */
  footer{
    display:none;position:fixed;left:0;right:0;bottom:0;padding:14px 16px;
    background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.45));
    backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
    border-top:1px solid var(--border);
  }
  .footer-inner{max-width:820px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;color:var(--muted);font-size:13px}
  .settings-link{padding:6px 10px;border:1px solid var(--glass-border);border-radius:8px;background:var(--glass)}

  /* Views + iPad-style transitions */
  .view{display:none; opacity:0; transform:translateX(12px); transition: opacity var(--transition), transform var(--transition)}
  .view.active{display:block; opacity:1; transform:translateX(0)}
  .view.exiting{opacity:0; transform:translateX(-12px)}

  /* Streaks */
  .streak-wrap{display:flex;justify-content:center;align-items:center;min-height:52vh}
  .streak-pills{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;max-width:680px}
  .pill{
    padding:10px 14px;border-radius:999px;
    background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
    border:1px solid var(--glass-border);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06),0 6px 18px rgba(0,0,0,.25);
    backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
    font-size:18px
  }

  /* Auth (simulated) */
  .auth{max-width:520px;margin:24px auto 0;background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  .auth h3{margin:4px 0 12px;font-size:18px}
  .field{display:flex;flex-direction:column;gap:8px;margin:12px 0}
  .input{width:100%;padding:14px;background:#0c0e12;border:1px solid var(--border);border-radius:var(--radius-xs);color:var(--text)}
  .consent{
    display:flex;align-items:center;gap:10px;cursor:pointer;padding:10px 12px;border-radius:12px;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
    border:1px solid var(--glass-border);box-shadow:inset 0 1px 0 rgba(255,255,255,.07);user-select:none
  }
  .consent input{accent-color:#38dd7d;width:18px;height:18px}
  .pretend{margin-top:10px;color:var(--muted);font-size:13px;padding:10px 12px;background:#0c1016;border:1px dashed var(--border);border-radius:10px;display:none}

  /* Celebration overlay */
  .celebrate{
    position:fixed;inset:0;display:none;place-content:center;background:rgba(5,8,12,.75);
    backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px); z-index:50;
    opacity:0; transform:scale(.98); transition:opacity 260ms ease, transform 260ms ease;
  }
  .celebrate.show{display:grid;opacity:1;transform:scale(1)}
  .cele-card{
    width:min(880px,92vw);
    background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02)), var(--panel);
    border:1px solid var(--glass-border); border-radius:22px; box-shadow:0 30px 80px rgba(0,0,0,.6); overflow:hidden;
  }
  .cele-hero{
    padding:28px 22px 18px; text-align:center; position:relative;
  }
  .bigtick{font-size:54px; display:inline-block; filter:drop-shadow(0 6px 18px rgba(42,214,108,.4))}
  .cele-title{margin:10px 0 6px; font-size:24px; font-weight:800; letter-spacing:-.01em}
  .cele-sub{color:var(--muted); font-size:14px}
  .cele-archive{
    max-height:min(44vh,420px); overflow:auto; border-top:1px solid var(--border);
    background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));
  }
  .cele-archive table{width:100%; border-collapse:separate; border-spacing:0}
  .cele-archive th, .cele-archive td{padding:12px 14px; text-align:left}
  .cele-archive thead th{position:sticky; top:0; background:#0f1116d9; backdrop-filter:blur(6px); color:var(--muted); font-size:12px}
  .cele-archive tbody tr{border-top:1px solid var(--border)}
  .cele-actions{display:flex;justify-content:center;gap:12px;padding:16px}
  .btn-ghost{
    padding:12px 14px;border:1px solid var(--glass-border);border-radius:12px;background:var(--glass);
    color:var(--text);font-weight:600;cursor:pointer
  }

  /* Confetti (simple) */
  .confetti{position:absolute;inset:0; pointer-events:none; overflow:hidden}
  .confetti i{
    position:absolute; width:8px; height:14px; opacity:.9;
    background:linear-gradient(180deg,#fff,rgba(255,255,255,.6));
    animation:fall 1200ms ease-in forwards;
    border-radius:3px;
  }
  @keyframes fall{
    to{ transform:translateY(280px) rotate(240deg); opacity:.0 }
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="brand">
    <div class="dot"></div>
    <h1>One Thing</h1>
  </div>
  <div class="subtitle">Log one meaningful action per day. Calm, clear, long‑term.</div>

  <!-- NAV -->
  <div class="nav">
    <a href="#app">Home</a>
    <a href="#streaks">Streaks</a>
    <a href="#settings">Settings</a>
    <a href="#auth">Sign up (simulated)</a>
  </div>

  <!-- HOME -->
  <div id="app" class="view active">
    <div class="card">
      <div class="stack">
        <div class="row">
          <input id="oneThingInput" class="onething" type="text" placeholder="">
          <button id="logBtn" class="btn">Save &amp; Log</button>
        </div>
      </div>
      <div id="todayCapsule" class="today"></div>
    </div>
  </div>

  <!-- STREAKS -->
  <div id="streaks" class="view">
    <div class="streak-wrap">
      <div class="streak-pills" id="streakPills"></div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="settings" class="view">
    <div class="card" style="padding:18px;">
      <h3 style="margin:4px 0 6px;">Settings</h3>
      <p class="subtitle" style="margin:0 0 14px;">Minimal. Only what’s essential.</p>
      <button id="deactivateBtn" class="btn" style="background:linear-gradient(180deg,#ff7b7b,#ff5252); border-color:#ff6b6b; color:#1b0b0b; box-shadow:0 6px 18px rgba(255,105,105,.35);">Deactivate account (clear all)</button>
      <div class="pretend" style="display:block;margin-top:12px;">This clears local data for this prototype.</div>
    </div>
  </div>

  <!-- AUTH (SIMULATED) -->
  <div id="auth" class="view">
    <div class="auth">
      <h3>Create your account (simulated)</h3>
      <div class="field">
        <label>Name</label>
        <input id="name" class="input" type="text" placeholder="Your name">
      </div>
      <div class="field">
        <label>Email</label>
        <input id="email" class="input" type="email" placeholder="you@example.com">
      </div>
      <div class="field">
        <label>Password</label>
        <input id="pass" class="input" type="password" placeholder="••••••••">
      </div>
      <div class="field">
        <label>Confirm password</label>
        <input id="confirm" class="input" type="password" placeholder="••••••••">
      </div>
      <label class="consent">
        <input id="consent" type="checkbox">
        <span>I agree to data protection & privacy terms.</span>
      </label>
      <button id="signupBtn" class="btn" style="margin-top:14px;">Create account</button>
      <div id="pretendBlock" class="pretend">✅ Pretend: a magic link was just “sent”. We’re not sending emails in this prototype.</div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer id="footer">
  <div class="footer-inner">
    <span>© Teddy’s Storytelling</span>
    <a class="settings-link" href="#settings">Settings</a>
  </div>
</footer>

<!-- CELEBRATION OVERLAY -->
<div id="celebrate" class="celebrate" aria-modal="true" role="dialog">
  <div class="cele-card">
    <div class="cele-hero">
      <div class="confetti" id="confetti"></div>
      <div class="bigtick">✅</div>
      <div class="cele-title">Goal logged!</div>
      <div id="celeToday" class="cele-sub"></div>
    </div>
    <div class="cele-archive">
      <table>
        <thead>
          <tr><th style="width:160px">Date</th><th>Past goals (read‑only)</th></tr>
        </thead>
        <tbody id="celeBody"></tbody>
      </table>
    </div>
    <div class="cele-actions">
      <button id="closeCele" class="btn-ghost">Close</button>
    </div>
  </div>
</div>

<script>
/* ---------- Keys ---------- */
const KEYS = {
  LOGS:'oneThing.logs',
  STREAK:'oneThing.streak',
  LAST_LOG:'oneThing.lastLog',
  HAS_FOOTER:'oneThing.hasFooter'
};

/* ---------- Utils ---------- */
const todayISO = () => new Date().toISOString().slice(0,10);
const fmtDate = iso => new Date(iso+'T00:00:00').toLocaleDateString(undefined,{weekday:'short',month:'short',day:'numeric',year:'numeric'});
const sameDay = (a,b)=> a===b;
const yISO = ()=>{ const d=new Date(); d.setDate(d.getDate()-1); return d.toISOString().slice(0,10); };

function load(k, def){ try{ const v=JSON.parse(localStorage.getItem(k)); return v??def; }catch{ return def; } }
function save(k, v){ localStorage.setItem(k, JSON.stringify(v)); }

/* ---------- Randomized placeholder ---------- */
const placeholders = [
  "Close a £200k sale",
  "Tell a loved one one thing you appreciate about them",
  "Run 5 kilometers this week"
];
function setRandomPlaceholder(el){
  const pick = placeholders[Math.floor(Math.random()*placeholders.length)];
  el.setAttribute('placeholder', pick);
}

/* ---------- State helpers ---------- */
function getLogs(){ return load(KEYS.LOGS, []); }
function setLogs(arr){ save(KEYS.LOGS, arr); }
function getStreak(){ return load(KEYS.STREAK, 0); }
function setStreak(n){ save(KEYS.STREAK, n); }
function getLastLog(){ return localStorage.getItem(KEYS.LAST_LOG); }
function setLastLog(iso){ localStorage.setItem(KEYS.LAST_LOG, iso); }

/* ---------- DOM ---------- */
const views = {
  app: document.getElementById('app'),
  streaks: document.getElementById('streaks'),
  settings: document.getElementById('settings'),
  auth: document.getElementById('auth')
};
const input = document.getElementById('oneThingInput');
const logBtn = document.getElementById('logBtn');
const todayCapsule = document.getElementById('todayCapsule');
const footer = document.getElementById('footer');

const pills = document.getElementById('streakPills');
const deactivateBtn = document.getElementById('deactivateBtn');

const signupBtn = document.getElementById('signupBtn');
const pretendBlock = document.getElementById('pretendBlock');

/* Celebration */
const cele = document.getElementById('celebrate');
const celeBody = document.getElementById('celeBody');
const celeToday = document.getElementById('celeToday');
const closeCele = document.getElementById('closeCele');
const confettiBox = document.getElementById('confetti');

/* ---------- Rendering ---------- */
function renderTodayCapsule(){
  const logs = getLogs();
  const t = todayISO();
  const today = logs.filter(x=> x.date===t).sort((a,b)=> a.time>b.time?-1:1)[0];
  if(today){
    todayCapsule.innerHTML = `<span>${fmtDate(today.date)}</span> — <strong>${today.text}</strong>`;
    todayCapsule.style.display = 'flex';
  } else {
    todayCapsule.style.display = 'none';
  }
}

function renderStreak(){
  const n = getStreak();
  pills.innerHTML = '';
  if(n<=0){
    const d = document.createElement('div');
    d.className='pill'; d.textContent='No streak yet — log today ✅';
    pills.appendChild(d); return;
  }
  for(let i=0;i<n;i++){
    const d = document.createElement('div'); d.className='pill'; d.textContent='✅'; pills.appendChild(d);
  }
}

function updateFooter(){
  const has = localStorage.getItem(KEYS.HAS_FOOTER) === '1';
  footer.style.display = has ? 'block' : 'none';
}

/* ---------- Celebration (read-only archive) ---------- */
function spawnConfetti(n=40){
  confettiBox.innerHTML = '';
  const W = confettiBox.clientWidth || 800;
  for(let i=0;i<n;i++){
    const piece = document.createElement('i');
    piece.style.left = Math.random()*W + 'px';
    piece.style.top = (-Math.random()*140) + 'px';
    piece.style.transform = `rotate(${Math.random()*180}deg)`;
    piece.style.animationDelay = (Math.random()*0.5)+'s';
    piece.style.background = Math.random()>.5
      ? 'linear-gradient(180deg,#9ef2c2,#2ad66c)'
      : 'linear-gradient(180deg,#c6d1ff,#7ca8ff)';
    confettiBox.appendChild(piece);
  }
}

function openCelebration(todaysEntry){
  // Fill headline
  celeToday.textContent = `${fmtDate(todaysEntry.date)} — ${todaysEntry.text}`;
  // Build archive (all logs, newest first)
  const logs = getLogs().sort((a,b)=> (a.date===b.date ? (a.time>b.time?-1:1) : (a.date<b.date?1:-1)));
  celeBody.innerHTML = '';
  logs.forEach(item=>{
    const tr = document.createElement('tr');
    const td1 = document.createElement('td'); td1.textContent = fmtDate(item.date);
    const td2 = document.createElement('td'); td2.textContent = item.text;
    tr.appendChild(td1); tr.appendChild(td2); celeBody.appendChild(tr);
  });
  spawnConfetti();
  cele.classList.add('show');
  cele.style.display='grid';
}

function closeCelebration(){
  cele.classList.remove('show');
  setTimeout(()=>{ cele.style.display='none'; celeBody.innerHTML=''; confettiBox.innerHTML=''; }, 260);
}

/* ---------- Actions ---------- */
function addLog(){
  const text = (input.value||'').trim();
  if(!text) return;

  const iso = todayISO();
  const logs = getLogs();

  // Save entry with time for ordering within the day
  const now = new Date();
  const entry = { date: iso, text, time: now.toISOString() };
  logs.push(entry);
  setLogs(logs);

  // Streak logic
  const last = getLastLog();
  if(!last){ setStreak(1); }
  else if (sameDay(last, iso)){ /* same-day: unchanged */ }
  else if (sameDay(last, yISO())){ setStreak(getStreak()+1); }
  else { setStreak(1); }
  setLastLog(iso);

  // Footer after first log
  localStorage.setItem(KEYS.HAS_FOOTER,'1');
  updateFooter();

  input.value='';
  renderTodayCapsule();
  renderStreak();

  // Open celebration overlay with read-only archive
  openCelebration(entry);
}

/* ---------- Routing with iPad-style transitions ---------- */
let currentKey = 'app';
function show(hash){
  const key = (hash||'#app').replace('#','');
  if(key===currentKey) return;

  const current = views[currentKey];
  const next = views[key] || views.app;

  // exit animation
  if(current){
    current.classList.add('exiting');
    setTimeout(()=>{
      current.classList.remove('active','exiting');
      next.classList.add('active');
      currentKey = key;
    }, 180); // slight overlap for smoothness
  } else {
    next.classList.add('active'); currentKey = key;
  }
}
window.addEventListener('hashchange', ()=> show(location.hash));

/* ---------- Events ---------- */
document.getElementById('logBtn').addEventListener('click', addLog);
document.getElementById('oneThingInput').addEventListener('keydown', e=>{ if(e.key==='Enter') addLog(); });

deactivateBtn.addEventListener('click', ()=>{
  if(confirm('Deactivate account and clear all data?')){
    Object.values(KEYS).forEach(k=> localStorage.removeItem(k));
    localStorage.removeItem('oneThing.user');
    updateFooter(); renderTodayCapsule(); renderStreak();
    location.hash = '#app'; currentKey='app'; show('#app');
    alert('All cleared. Fresh start.');
  }
});

signupBtn.addEventListener('click', ()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value;
  const confirm = document.getElementById('confirm').value;
  const consent = document.getElementById('consent').checked;

  if(!name || !email || !pass || !confirm){ alert('Please complete all fields.'); return; }
  if(pass !== confirm){ alert('Passwords do not match.'); return; }
  if(!consent){ alert('Please tick the data protection consent.'); return; }

  // Simulated create + magic link
  localStorage.setItem('oneThing.user', JSON.stringify({name,email}));
  pretendBlock.style.display='block';
});

document.getElementById('closeCele').addEventListener('click', closeCelebration);

/* ---------- Init ---------- */
(function init(){
  setRandomPlaceholder(document.getElementById('oneThingInput'));
  renderTodayCapsule();
  renderStreak();
  updateFooter();
  // initial route
  const initial = location.hash || '#app';
  currentKey = initial.replace('#','') || 'app';
  Object.values(views).forEach(v=>v.classList.remove('active','exiting'));
  (views[currentKey]||views.app).classList.add('active');
})();
</script>
</body>
</html>